# Claude-Powered Trading Agent (Alternative Version)

This document explains how to use the Claude-specific version of the AI Trading Agent.

## Overview

The **`trading-agent-claude.py`** is an alternative implementation of the original trading agent that uses **Claude Sonnet 4.5** instead of OpenAI and Perplexity for all AI-powered analysis and recommendations.

**All other features remain identical** - you get the same portfolio tracking, technical analysis, backtesting, and trading capabilities. Only the AI backbone has changed.

## Key Differences from Original

| Feature | Original | Claude Version |
|---------|----------|----------------|
| Stock Discovery | Perplexity API (sonar-pro) | **Claude Sonnet 4.5** |
| Financial Analysis | OpenAI GPT-5 | **Claude Sonnet 4.5** |
| Hedging Strategy | OpenAI GPT-5 | **Claude Sonnet 4.5** |
| Trend Query Generation | OpenAI GPT-4-turbo | **Claude Sonnet 4.5** |
| All other features | Same | **Same** |

## Setup Instructions

### 1. Get Claude API Key

1. Go to [Anthropic Console](https://console.anthropic.com/)
2. Sign up or log in
3. Navigate to the API Keys section
4. Create a new API key
5. Copy the key (it will start with `sk-ant-`)

### 2. Update .env File

Add the Claude API key to your `.env` file:

```bash
# Claude API (Required for trading-agent-claude.py)
CLAUDE_API_KEY="sk-ant-your-api-key-here"

# Keep these for other features (same as before)
QUANTIQ_API="your_quantiq_api_key"
ALPACA_API_KEY="YOUR_PAPER_API_KEY_ID"
ALPACA_SECRET_KEY="YOUR_PAPER_SECRET_KEY"
ALPACA_PAPER="true"
FMP_API_KEY="your_fmp_api_key"
FRED_API_KEY="your_fred_api_key"
REDDIT_CLIENT_ID="your_reddit_client_id"
REDDIT_CLIENT_SECRET="your_reddit_client_secret"
REDDIT_USER_AGENT="your_user_agent"
NEWSAPI_KEY="your_newsapi_key"
```

### 3. Install Claude SDK

The Claude SDK is likely not installed if you've been using the original version. Install it:

```bash
pip install anthropic
```

Or add it to your `requirements.txt`:

```
anthropic>=0.7.0
```

Then install:

```bash
pip install -r requirements.txt
```

### 4. Run the Claude Version

```bash
streamlit run trading-agent-claude.py
```

The app will launch with a "ðŸ¤– Powered by Claude Sonnet 4.5" indicator at the top.

## How to Use

The user interface is **100% identical** to the original version. All commands work the same way:

- `find stocks` - Discover small-cap stocks (now powered by Claude instead of Perplexity)
- `analyze AAPL` - Get buy/sell recommendations (now powered by Claude instead of GPT-5)
- `hedge` - Get hedging strategies (now powered by Claude instead of GPT-5)
- `get technicals MSFT` - View technical charts (same as before)
- `get trends TSLA` - View Google Trends (queries now generated by Claude instead of GPT-4)
- `get news GME` - News articles (same as before)
- `get social sentiment AMZN` - Reddit sentiment (same as before)
- `enable auto-pilot` - Automated trading (now uses Claude for recommendations)

All other features work identically:
- Portfolio Performance tracking
- Backtesting Engine
- Event Calendar
- Macro Indicators
- Trading via Alpaca API

## Why Use the Claude Version?

### Advantages

1. **Better Reasoning**: Claude excels at complex financial analysis and multi-factor decision making
2. **Larger Context Window**: 200K token limit allows analyzing more data at once (especially useful for auto-pilot mode)
3. **Improved Accuracy**: Superior performance at quantitative reasoning and structured output
4. **Cost-Effective**: With Batch API usage, Claude can be more economical at scale
5. **Consistency**: More reliable and consistent recommendations across sessions
6. **Simplified Setup**: One API key instead of managing Perplexity + OpenAI

### Performance Comparison

Based on the capabilities:

| Metric | Original | Claude Version |
|--------|----------|----------------|
| Stock Analysis Quality | Good | Better |
| Multi-factor Analysis | Good | Better |
| Financial Reasoning | Good | Better |
| Context Available | Standard | Much larger (200K tokens) |
| API Simplicity | 2 services | 1 service |
| Cost Efficiency | Standard | Potential savings with Batch API |

## API Rate Limits & Costs

### Claude Rate Limits (Free tier)
- 5 requests per minute
- 100K tokens per day

### Claude Rate Limits (Paid tier)
- No strict request limits
- No daily token limits
- Pay per token (~$0.003 per 1K input tokens, ~$0.015 per 1K output tokens)

### Recommendations

For heavy usage (auto-pilot mode), you may want to implement request batching or add small delays between requests.

## Troubleshooting

### "Claude API key is not set"
**Solution**: Ensure `CLAUDE_API_KEY` is in your `.env` file and spelled correctly.

### "Error getting recommendation from Claude"
**Solution**:
- Check your API key is valid
- Ensure you have sufficient API credits
- Check rate limits (may need to add small delays for rapid requests)
- Check your internet connection

### "ModuleNotFoundError: No module named 'anthropic'"
**Solution**: Install the Claude SDK:
```bash
pip install anthropic
```

### Claude responses are inconsistent
**Solution**: This is normal - Claude has inherent randomness. You can reduce it by adjusting temperature (currently set to default). The consistency is still better than alternatives for financial analysis.

## Switching Between Versions

You can easily switch between versions:

```bash
# Use original (OpenAI + Perplexity)
streamlit run trading-agent.py

# Use Claude version
streamlit run trading-agent-claude.py
```

**Note**: Both versions share the same `portfolio.csv` file, so your trading history is preserved across both versions.

## File Structure

```
gpt-trading-agent/
â”œâ”€â”€ trading-agent.py              # Original version (OpenAI + Perplexity)
â”œâ”€â”€ trading-agent-claude.py       # Claude version (NEW)
â”œâ”€â”€ portfolio.csv                 # Shared trading history
â”œâ”€â”€ requirements.txt              # Dependencies
â”œâ”€â”€ .env                          # API keys
â”œâ”€â”€ README.md                     # Original documentation
â””â”€â”€ CLAUDE_VERSION.md            # This file
```

## Advanced: Using Claude Batch API (Future Enhancement)

If you want to implement batch processing for cost savings (especially useful for auto-pilot mode), you can modify the Claude calls to use the Batch API:

```python
# Example: Batch processing multiple stock analyses
batch_messages = [
    {"role": "user", "content": f"Analyze {ticker}..."},
    {"role": "user", "content": f"Analyze {ticker2}..."},
    # ... more stocks
]

# Submit batch job for processing
# Results come back at a discount rate (~50% cheaper)
```

This would require additional implementation but Claude's Batch API is officially supported in the SDK.

## Differences in Output Format

Claude's responses are typically:
- More detailed explanations
- Better formatted text
- More nuanced reasoning
- Slightly longer (more thorough)

This is generally a **benefit** for financial analysis, but if you prefer shorter responses, you can modify the system prompts in the code.

## Modifying Prompts

If you want to customize how Claude analyzes stocks, edit the `get_stock_recommendation()` function:

```python
def get_stock_recommendation(ticker, financials):
    """
    Uses Claude to get a buy, sell, or short-sell recommendation for a stock.
    """
    try:
        message = claude_client.messages.create(
            model=MODEL_NAME,
            max_tokens=500,
            messages=[
                {
                    "role": "user",
                    "content": f"CUSTOMIZE THIS PROMPT: Should I invest in {ticker}? ..."
                }
            ],
            system="CUSTOMIZE THIS SYSTEM PROMPT: You are a financial analyst..."
        )
        return message.content[0].text
    except Exception as e:
        st.error(f"Error getting recommendation from Claude: {e}")
        return "Error"
```

## Support & Resources

- **Claude Documentation**: https://docs.anthropic.com/
- **API Reference**: https://docs.anthropic.com/en/api/getting-started
- **Cookbook Examples**: https://github.com/anthropics/anthropic-sdk-python

## Conclusion

The Claude version offers a **drop-in replacement** for the original trading agent with improved analysis quality and simplified API management. All trading, portfolio tracking, and backtesting features work identically. The main benefit is better financial reasoning and a larger context window for multi-factor analysis.

Enjoy analyzing stocks with Claude! ðŸš€
